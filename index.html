<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hrishikesh Prasad Malave - DevOps/Cloud Engineer Portfolio</title>
    <!-- Load Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Custom Tailwind Configuration and Base Styles */
        :root {
            /* Define a custom blue for the accent color */
            --color-custom-blue: #3498db;
        }

        /* Applying Inter font and general transitions */
        body {
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        /* Base colors for Light Mode */
        .light-theme {
            --color-bg-primary: #f8f9fa;
            --color-bg-secondary: #ffffff;
            --color-text-primary: #1f2937;
            --color-text-secondary: #111827;
            --color-accent: #2563eb;
            --color-skill-bg: #e0f2fe;
            --color-skill-text: #1e40af;
            --color-project-skill-bg: #d1fae5;
            --color-project-skill-text: #065f46;
        }

        /* Base colors for Dark Mode */
        .dark-theme {
            --color-bg-primary: #1a202c;
            --color-bg-secondary: #2d3748;
            --color-text-primary: #e2e8f0;
            --color-text-secondary: #ffffff;
            --color-accent: #63b3ed;
            --color-skill-bg: #4a5568;
            --color-skill-text: #e2e8f0;
            --color-project-skill-bg: #48bb78;
            --color-project-skill-text: #1a202c;
        }

        /* Apply dynamic colors based on theme */
        body {
            background-color: var(--color-bg-primary);
            color: var(--color-text-primary);
        }
        .text-primary { color: var(--color-text-primary); }
        .text-secondary { color: var(--color-text-secondary); }
        .bg-secondary { background-color: var(--color-bg-secondary); }

        /* Custom style for the section title underline */
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background-color: var(--color-accent);
            border-radius: 9999px;
            transition: background-color 0.3s ease;
        }

        /* Dynamic skill tag colors */
        .skill-item {
            background-color: var(--color-skill-bg);
            color: var(--color-skill-text);
        }
        .project-skill-tag {
            background-color: var(--color-project-skill-bg);
            color: var(--color-project-skill-text);
        }
        
        /* Set initial theme */
        body {
            @apply light-theme;
        }
        body.dark-mode {
            @apply dark-theme;
        }
    </style>
</head>
<body class="light-theme">

    <!-- Header Section -->
    <header class="bg-gradient-to-r from-blue-700 to-indigo-600 text-white p-6 shadow-xl relative transition duration-300">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 max-w-7xl">
            
            <div class="flex flex-col md:flex-row items-center space-x-6">
                <!-- Profile Image Placeholder -->
                <img src="passportsize.jpg" alt="Hrishikesh Prasad Malave" 
                     class="w-36 h-36 rounded-full object-cover border-4 border-white shadow-lg transition duration-300 hover:scale-105">
                
                <div class="text-center md:text-left">
                    <h1 class="text-5xl font-extrabold mb-1">Hrishikesh Prasad Malave</h1>
                    <p class="text-2xl font-light opacity-90">DevOps & Cloud Engineer</p>
                    <p class="text-lg font-medium opacity-80 mt-1">B.Tech. - Computer Science Engineering</p>
                </div>
            </div>

            <!-- Contact Info -->
            <div class="text-sm space-y-2 md:text-right pt-4 md:pt-0">
                <p class="flex items-center justify-center md:justify-end">
                    <svg class="w-5 h-5 mr-2 text-blue-300" fill="currentColor" viewBox="0 0 20 20"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.956.71l1.25 4.298a1 1 0 01-.54 1.155l-1.745.723a1 1 0 00-.5.868v2.731a1 1 0 00.174.553l.067.098a1 1 0 00.868.5l2.731-.5a1 1 0 00.868.5l.723-1.745a1 1 0 011.155-.54l4.298 1.25a1 1 0 01.71.956V17a1 1 0 01-1 1h-2.153a1 1 0 01-.956-.71l-1.25-4.298a1 1 0 01.54-1.155l1.745-.723a1 1 0 00.5-.868v-2.731a1 1 0 00-.174-.553l-.067-.098a1 1 0 00-.868-.5l-2.731.5a1 1 0 00-.868.5l-.723 1.745a1 1 0 01-1.155.54l-4.298-1.25A1 1 0 013 3z"/></svg>
                    +91-7264051212
                </p>
                <p class="flex items-center justify-center md:justify-end">
                    <svg class="w-5 h-5 mr-2 text-blue-300" fill="currentColor" viewBox="0 0 20 20"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/></svg>
                    <a href="mailto:hrishikeshmalave@gmail.com" class="text-white hover:text-blue-200 transition">hrishikeshmalave@gmail.com</a>
                </p>
                <p class="flex items-center justify-center md:justify-end">
                    <svg class="w-5 h-5 mr-2 text-blue-300" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16 4H4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2zm-1.5 6.5a.5.5 0 01-.5.5h-9a.5.5 0 01-.5-.5v-3a.5.5 0 01.5-.5h9a.5.5 0 01.5.5v3z" clip-rule="evenodd"/></svg>
                    <a href="https://www.linkedin.com/in/hrishikesh-malave-890948169" target="_blank" class="text-white hover:text-blue-200 transition">LinkedIn Profile</a>
                </p>
                <p class="flex items-center justify-center md:justify-end">
                    <svg class="w-5 h-5 mr-2 text-blue-300" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM7 9a1 1 0 100-2 1 1 0 000 2zm3-1a1 1 0 11-2 0 1 1 0 012 0zm3 1a1 1 0 100-2 1 1 0 000 2zm-3 4a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/></svg>
                    Pune, Maharashtra, India-411046
                </p>
            </div>
        </div>
        
        <!-- Dark Mode Toggle Button -->
        <button id="darkModeToggle" class="absolute top-4 right-4 bg-white bg-opacity-20 text-white rounded-lg px-3 py-2 text-sm font-medium hover:bg-opacity-30 transition flex items-center gap-2">
            <svg class="w-5 h-5 sun-icon hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            <svg class="w-5 h-5 moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            <span id="darkModeText">Dark Mode</span>
        </button>
    </header>

    <main class="py-10">
        <!-- About Me Section -->
        <section id="about" class="pb-10">
            <div class="container mx-auto max-w-7xl px-6">
                <div class="bg-secondary rounded-xl shadow-lg p-6 md:p-10 transition duration-300">
                    <h2 class="section-title text-secondary text-4xl font-extrabold text-center mb-10 relative">About Me</h2>
                    <p class="text-primary text-lg leading-relaxed text-center max-w-4xl mx-auto">
                        System Engineer at TCS with 3+ years in managing and automating enterprise systems.
                        Skilled in AWS, Azure, Docker, Kubernetes, Jenkins, Ansible, and Python. Strong in scripting, CI/CD, and infrastructure automation (IaC).
                        Seeking challenging DevOps/Cloud Engineer roles to build scalable, reliable, and efficient cloud-native systems.
                    </p>
                </div>
            </div>
        </section>

        <!-- Technical Skills Section -->
        <section id="technical-skills" class="py-10">
            <div class="container mx-auto max-w-7xl px-6">
                <h2 class="section-title text-secondary text-4xl font-extrabold text-center mb-10 relative">TECHNICAL SKILLS</h2>
                
                <div class="bg-secondary rounded-xl shadow-lg p-6 md:p-10 space-y-6 transition duration-300">
                    <!-- Skill Categories Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        
                        <div class="flex flex-col space-y-2">
                            <span class="text-xl font-bold text-blue-600 dark:text-blue-400">Cloud Platforms:</span>
                            <div class="flex flex-wrap gap-2">
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">AWS</span>
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Microsoft Azure</span>
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Google Cloud Platform (GCP)</span>
                            </div>
                        </div>

                        <div class="flex flex-col space-y-2">
                            <span class="text-xl font-bold text-blue-600 dark:text-blue-400">Containerization & Orchestration:</span>
                            <div class="flex flex-wrap gap-2">
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Docker</span>
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Kubernetes (AKS)</span>
                            </div>
                        </div>

                        <div class="flex flex-col space-y-2">
                            <span class="text-xl font-bold text-blue-600 dark:text-blue-400">CI/CD & Automation:</span>
                            <div class="flex flex-wrap gap-2">
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Jenkins</span>
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">GitHub Actions</span>
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Ansible</span>
                            </div>
                        </div>

                        <div class="flex flex-col space-y-2">
                            <span class="text-xl font-bold text-blue-600 dark:text-blue-400">Infrastructure as Code (IaC):</span>
                            <div class="flex flex-wrap gap-2">
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Terraform</span>
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Terragrunt</span>
                            </div>
                        </div>

                        <div class="flex flex-col space-y-2">
                            <span class="text-xl font-bold text-blue-600 dark:text-blue-400">Scripting & Programming:</span>
                            <div class="flex flex-wrap gap-2">
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Python</span>
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Shell Scripting</span>
                            </div>
                        </div>
                        
                        <div class="flex flex-col space-y-2">
                            <span class="text-xl font-bold text-blue-600 dark:text-blue-400">Monitoring & Version Control:</span>
                            <div class="flex flex-wrap gap-2">
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Grafana</span>
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Prometheus</span>
                                <span class="skill-item text-base font-medium rounded-full px-3 py-1">Git/GitHub</span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </section>

        <!-- Work Experience Section -->
        <section id="work-experience" class="py-10">
            <div class="container mx-auto max-w-7xl px-6">
                <h2 class="section-title text-secondary text-4xl font-extrabold text-center mb-10 relative">Work Experience</h2>
                
                <div class="bg-secondary rounded-xl shadow-lg p-6 md:p-10 transition duration-300">
                    <div class="flex justify-between items-start mb-4 flex-wrap">
                        <div class="order-2 md:order-1">
                            <h3 class="text-2xl font-bold text-secondary">System Engineer</h3>
                            <p class="text-xl font-medium text-gray-600 dark:text-gray-400 mb-1">Tata Consultancy Services, Pune</p>
                        </div>
                        <p class="text-lg font-semibold text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 px-3 py-1 rounded-full order-1 md:order-2 mb-2 md:mb-0">
                            Oct 2022 â€“ Present
                        </p>
                    </div>
                    
                    <ul class="list-disc list-outside ml-6 space-y-3 text-primary text-lg">
                        <li class="pl-2">Implemented, developed, and managed CI/CD pipelines in Azure DevOps for seamless application deployment, significantly reducing manual intervention.</li>
                        <li class="pl-2">Orchestrated containerized applications using Kubernetes and Docker to support a robust microservices architecture, ensuring scalability and resource efficiency.</li>
                        <li class="pl-2">Engineered Terraform-based IaC CI/CD pipelines integrated with Jenkins, cutting deployment time by 50% and enhancing developer productivity.</li>
                        <li class="pl-2">Maintained a high availability clustered environment of 500+ Linux servers, ensuring 99.9% system uptime and reliability through proactive monitoring and automation.</li>
                        <li class="pl-2">Enhanced system performance by achieving a 30% reduction in downtime incidents and optimizing resource utilization using Grafana, Prometheus, and VMware tools.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Projects Section -->
        <section id="projects" class="py-10">
            <div class="container mx-auto max-w-7xl px-6">
                <h2 class="section-title text-secondary text-4xl font-extrabold text-center mb-10 relative">Projects</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8">

                    <!-- Project Card 1 -->
                    <div class="bg-secondary rounded-xl shadow-xl p-6 hover:shadow-2xl transition duration-300 hover:scale-[1.02]">
                        <h3 class="text-xl font-bold text-secondary mb-2">Terraform & Bitbucket CI/CD for Cloud Automation</h3>
                        <p class="text-primary mb-4 text-sm">Infrastructure as Code & GitOps Implementation</p>
                        <ul class="list-disc list-outside ml-5 space-y-1 text-primary text-base">
                            <li>Utilized Terragrunt and Terraform for IaC, reducing resource provisioning and deployment time by **40%**.</li>
                            <li>Implemented GitOps with Bitbucket CI/CD, boosting deployment consistency and ensuring service uptime by **20%**.</li>
                        </ul>
                        <div class="flex flex-wrap gap-2 mt-4">
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">Terraform</span>
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">Terragrunt</span>
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">Bitbucket CI/CD</span>
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">GitOps</span>
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">IaC</span>
                        </div>
                    </div>

                    <!-- Project Card 2 -->
                    <div class="bg-secondary rounded-xl shadow-xl p-6 hover:shadow-2xl transition duration-300 hover:scale-[1.02]">
                        <h3 class="text-xl font-bold text-secondary mb-2">Kubernetes-Based Multi-Cloud Application Deployment</h3>
                        <p class="text-primary mb-4 text-sm">High-Availability Container Orchestration</p>
                        <ul class="list-disc list-outside ml-5 space-y-1 text-primary text-base">
                            <li>Designed and deployed a high-availability web architecture on AWS with dynamic content and Amazon RDS for scalable backend storage.</li>
                            <li>Set up an automated CI/CD Pipeline using Azure DevOps to deploy applications to an AKS cluster.</li>
                            <li>Implemented a 2-Tier Application using Kubernetes, configuring VPC and Compute Engine for a scalable GCP deployment.</li>
                        </ul>
                        <div class="flex flex-wrap gap-2 mt-4">
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">Kubernetes</span>
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">Azure DevOps</span>
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">AKS</span>
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">Amazon RDS</span>
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">VPC/GCP Compute</span>
                            <span class="project-skill-tag text-xs font-medium rounded-full px-3 py-1">CI/CD</span>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- Education Section -->
        <section id="education" class="py-10">
            <div class="container mx-auto max-w-7xl px-6">
                <h2 class="section-title text-secondary text-4xl font-extrabold text-center mb-10 relative">Education</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- B.Tech -->
                    <div class="bg-secondary rounded-xl shadow-lg p-6 hover:shadow-xl transition duration-300">
                        <h3 class="text-xl font-bold text-secondary mb-1">B.Tech in Computer Science</h3>
                        <p class="text-primary text-lg mb-1">PCET's Nutan College of Engineering and Research</p>
                        <p class="text-sm text-blue-600 dark:text-blue-400 font-semibold">2018 - 2022 | CGPA: 8.88/10</p>
                    </div>
                    <!-- 12th -->
                    <div class="bg-secondary rounded-xl shadow-lg p-6 hover:shadow-xl transition duration-300">
                        <h3 class="text-xl font-bold text-secondary mb-1">12th (HSC)</h3>
                        <p class="text-primary text-lg mb-1">Shivbhumi Jr. College</p>
                        <p class="text-sm text-blue-600 dark:text-blue-400 font-semibold">2018 | Percentage: 67.69%</p>
                    </div>
                    <!-- 10th -->
                    <div class="bg-secondary rounded-xl shadow-lg p-6 hover:shadow-xl transition duration-300">
                        <h3 class="text-xl font-bold text-secondary mb-1">10th (SSC)</h3>
                        <p class="text-primary text-lg mb-1">Shivbhumi Vidyalaya</p>
                        <p class="text-sm text-blue-600 dark:text-blue-400 font-semibold">2016 | Percentage: 84.20%</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Certifications Section -->
        <section id="certifications" class="py-10">
            <div class="container mx-auto max-w-7xl px-6">
                <h2 class="section-title text-secondary text-4xl font-extrabold text-center mb-10 relative">Certifications</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Cert 1 -->
                    <div class="bg-secondary rounded-xl shadow-lg p-4 text-center hover:shadow-xl transition duration-300 hover:scale-[1.02]">
                        <h3 class="text-lg font-semibold text-secondary mb-1">Microsoft Certified: Azure DevOps Engineer</h3>
                    </div>
                    <!-- Cert 2 -->
                    <div class="bg-secondary rounded-xl shadow-lg p-4 text-center hover:shadow-xl transition duration-300 hover:scale-[1.02]">
                        <h3 class="text-lg font-semibold text-secondary mb-1">AWS Certified Cloud Practitioner</h3>
                    </div>
                    <!-- Cert 3 -->
                    <div class="bg-secondary rounded-xl shadow-lg p-4 text-center hover:shadow-xl transition duration-300 hover:scale-[1.02]">
                        <h3 class="text-lg font-semibold text-secondary mb-1">Microsoft Certified: Azure Administrator Associate</h3>
                    </div>
                    <!-- Cert 4 -->
                    <div class="bg-secondary rounded-xl shadow-lg p-4 text-center hover:shadow-xl transition duration-300 hover:scale-[1.02]">
                        <h3 class="text-lg font-semibold text-secondary mb-1">Microsoft Certified: Azure Fundamentals</h3>
                    </div>
                </div>
            </div>
        </section>

        <!-- Extra-curricular & Interests Section -->
        <section id="extra-interests" class="py-10">
            <div class="container mx-auto max-w-7xl px-6">
                <h2 class="section-title text-secondary text-4xl font-extrabold text-center mb-10 relative">Extra-curricular & Interests</h2>
                <div class="bg-secondary rounded-xl shadow-lg p-6 md:p-10 transition duration-300">
                    <h3 class="text-2xl font-bold text-secondary mb-4">Personal Interests / Hobbies</h3>
                    <ul class="list-disc list-outside ml-6 space-y-1 text-primary text-lg">
                        <li>Playing Cricket</li>
                        <li>Reading tech blogs and open-source contributions</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-6 text-center transition duration-300">
        <div class="container mx-auto max-w-7xl">
            <p class="text-sm">&copy; 2025 Hrishikesh Prasad Malave. All rights reserved.</p>
            <p class="text-xs mt-1 opacity-70">Built with Code, Coffee, and DevOps principles.</p>
        </div>
    </footer>

    <!-- Firebase/Firestore and Dark Mode Logic -->
    <script type="module">
        // Firebase modules imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, getDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set log level to debug for better console output
        setLogLevel('Debug');

        // Global Firebase variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let userId = null;
        let isAuthReady = false;

        const body = document.body;
        const darkModeToggle = document.getElementById('darkModeToggle');
        const sunIcon = document.querySelector('.sun-icon');
        const moonIcon = document.querySelector('.moon-icon');
        const darkModeText = document.getElementById('darkModeText');

        // --- Utility Functions ---

        function applyTheme(isDark) {
            if (isDark) {
                body.classList.add('dark-mode');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
                darkModeText.textContent = 'Light Mode';
            } else {
                body.classList.remove('dark-mode');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
                darkModeText.textContent = 'Dark Mode';
            }
        }

        // --- Firebase Initialization and Auth ---

        async function initFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase configuration is missing or empty.");
                    // Fallback to local system preference if Firebase is not configured
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    applyTheme(prefersDark);
                    return;
                }

                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Sign in using the custom token or anonymously
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Listen for Auth state changes
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        console.log("Firebase Auth Ready. User ID:", userId);
                        // Once authenticated, start listening for the user's settings
                        listenForDarkModePreference();
                    } else {
                        // User is signed out. Fallback to anonymous ID if needed.
                        userId = crypto.randomUUID(); 
                        isAuthReady = true;
                        console.log("Signed in anonymously. Using generated User ID:", userId);
                        // Listen for settings even for anonymous user (private path)
                        listenForDarkModePreference(); 
                    }
                });

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
                // In case of failure, default to light mode
                applyTheme(false);
            }
        }

        // --- Firestore Operations ---

        function getDarkModeDocRef() {
            if (!userId) {
                console.error("Attempted to get doc ref before user ID is set.");
                return null;
            }
            // Private data path for user settings
            const path = `/artifacts/${appId}/users/${userId}/settings/darkMode`;
            return doc(db, path);
        }

        function listenForDarkModePreference() {
            const docRef = getDarkModeDocRef();
            if (!docRef) return;

            // Use onSnapshot for real-time updates
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    const isDark = data.enabled || false;
                    console.log("Firestore updated theme:", isDark ? "Dark" : "Light");
                    applyTheme(isDark);
                } else {
                    // Document doesn't exist, check system preference and initialize
                    console.log("No saved theme preference found. Checking system preference.");
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    applyTheme(prefersDark);
                    // Optionally set initial preference in Firestore
                    // saveDarkModePreference(prefersDark); 
                }
            }, (error) => {
                console.error("Error listening to dark mode preference:", error);
            });
        }

        async function saveDarkModePreference(isDark) {
            if (!isAuthReady || !db) {
                console.warn("Attempted to save preference before Firebase is ready.");
                return;
            }
            const docRef = getDarkModeDocRef();
            if (!docRef) return;
            try {
                // Set/overwrite the document
                await setDoc(docRef, { enabled: isDark });
                console.log("Dark mode preference saved to Firestore:", isDark);
            } catch (error) {
                console.error("Error saving dark mode preference:", error);
            }
        }

        // --- Event Listener ---

        darkModeToggle.addEventListener('click', () => {
            // Determine the new state based on the *current* class list
            const newIsDark = !body.classList.contains('dark-mode');
            // Optimistically apply the change for instant feedback
            applyTheme(newIsDark);
            // Persist the change to Firestore
            saveDarkModePreference(newIsDark);
        });

        // Initialize Firebase on DOM content loaded
        document.addEventListener('DOMContentLoaded', initFirebase);
        
    </script>

</body>
</html>
